%% Rotina para cálculo do incremento de pressão inserido pela bomba no sistema.

function [dp] = dinamica_dp(q_media, f, P, n)

switch n
     case {'LEA PID OVERRIDE','LEA','LEA PID','LINEARIZAÇÃO','INCERTEZA LEA ME','LEA MPC','VALIDAÇÃO LINEARIZAÇÃO','LEA MPC-2','IHMPC','IHMPC-Zone','LEA MPC Zone','LEA MPC Zone UE','RIHMPC','RIHMPC-Zone','LEA EXP'}
%     % Calcula a altura manométrica disponível
        
%         q_0a = q_media*(P.f0/f)/0.970585257378611;
        q_0a = q_media*(P.f0/f);
        H_0 = P.Head(1)*q_0a^2 +P.Head(2)*q_0a + P.Head(3);
        H = H_0*(f/P.f0)^2;
        % Delta P sairá em Pascal
        dp = H*P.rho(2)*P.g;
        
    case 'NTNU'
            %% With use of interpolation:
                
        % ESP characteristics data
        q50HzWC00 = zeros(50,1);
        h50HzWC00 = zeros(50,1);
        q50HzWC00(1) = 0.0000000000000000e+000;
        h50HzWC00(1) = 2.1328087588198112e+001;
        q50HzWC00(2) = 7.2103081632653057e-004;
        h50HzWC00(2) = 2.1153910731141231e+001;
        q50HzWC00(3) = 1.4420616326530611e-003;
        h50HzWC00(3) = 2.1003021167142585e+001;
        q50HzWC00(4) = 2.1630924489795915e-003;
        h50HzWC00(4) = 2.0860495404552417e+001;
        q50HzWC00(5) = 2.8841232653061223e-003;
        h50HzWC00(5) = 2.0715697663907040e+001;
        q50HzWC00(6) = 3.6051540816326522e-003;
        h50HzWC00(6) = 2.0561552773552283e+001;
        q50HzWC00(7) = 4.3261848979591830e-003;
        h50HzWC00(7) = 2.0393888661008280e+001;
        q50HzWC00(8) = 5.0472157142857138e-003;
        h50HzWC00(8) = 2.0210845409196214e+001;
        q50HzWC00(9) = 5.7682465306122446e-003;
        h50HzWC00(9) = 2.0012347846647739e+001;
        q50HzWC00(10) = 6.4892773469387745e-003;
        h50HzWC00(10) = 1.9799638640817694e+001;
        q50HzWC00(11) = 7.2103081632653044e-003;
        h50HzWC00(11) = 1.9574868863620786e+001;
        q50HzWC00(12) = 7.9313389795918360e-003;
        h50HzWC00(12) = 1.9340742998312887e+001;
        q50HzWC00(13) = 8.6523697959183660e-003;
        h50HzWC00(13) = 1.9100215356837637e+001;
        q50HzWC00(14) = 9.3734006122448959e-003;
        h50HzWC00(14) = 1.8856234876758968e+001;
        q50HzWC00(15) = 1.0094431428571428e-002;
        h50HzWC00(15) = 1.8611535266900248e+001;
        q50HzWC00(16) = 1.0815462244897957e-002;
        h50HzWC00(16) = 1.8368467470810668e+001;
        q50HzWC00(17) = 1.1536493061224489e-002;
        h50HzWC00(17) = 1.8128871417179571e+001;
        q50HzWC00(18) = 1.2257523877551019e-002;
        h50HzWC00(18) = 1.7893984026319366e+001;
        q50HzWC00(19) = 1.2978554693877549e-002;
        h50HzWC00(19) = 1.7664380441837654e+001;
        q50HzWC00(20) = 1.3699585510204079e-002;
        h50HzWC00(20) = 1.7439945456619284e+001;
        q50HzWC00(21) = 1.4420616326530609e-002;
        h50HzWC00(21) = 1.7219872102238945e+001;
        q50HzWC00(22) = 1.5141647142857142e-002;
        h50HzWC00(22) = 1.7002684370925007e+001;
        q50HzWC00(23) = 1.5862677959183672e-002;
        h50HzWC00(23) = 1.6786281039195210e+001;
        q50HzWC00(24) = 1.6583708775510204e-002;
        h50HzWC00(24) = 1.6567997562284916e+001;
        q50HzWC00(25) = 1.7304739591836732e-002;
        h50HzWC00(25) = 1.6344683008488524e+001;
        q50HzWC00(26) = 1.8025770408163264e-002;
        h50HzWC00(26) = 1.6112789002534804e+001;
        q50HzWC00(27) = 1.8746801224489792e-002;
        h50HzWC00(27) = 1.5868467647116674e+001;
        q50HzWC00(28) = 1.9467832040816323e-002;
        h50HzWC00(28) = 1.5607675391696205e+001;
        q50HzWC00(29) = 2.0188862857142855e-002;
        h50HzWC00(29) = 1.5326279817705444e+001;
        q50HzWC00(30) = 2.0909893673469383e-002;
        h50HzWC00(30) = 1.5020166309263734e+001;
        q50HzWC00(31) = 2.1630924489795915e-002;
        h50HzWC00(31) = 1.4685341578532192e+001;
        q50HzWC00(32) = 2.2351955306122443e-002;
        h50HzWC00(32) = 1.4318031014825994e+001;
        q50HzWC00(33) = 2.3072986122448978e-002;
        h50HzWC00(33) = 1.3914766826605094e+001;
        q50HzWC00(34) = 2.3794016938775510e-002;
        h50HzWC00(34) = 1.3472463945464220e+001;
        q50HzWC00(35) = 2.4515047755102038e-002;
        h50HzWC00(35) = 1.2988480661242455e+001;
        q50HzWC00(36) = 2.5236078571428570e-002;
        h50HzWC00(36) = 1.2460660957373419e+001;
        q50HzWC00(37) = 2.5957109387755098e-002;
        h50HzWC00(37) = 1.1887355515596516e+001;
        q50HzWC00(38) = 2.6678140204081630e-002;
        h50HzWC00(38) = 1.1267418359150049e+001;
        q50HzWC00(39) = 2.7399171020408158e-002;
        h50HzWC00(39) = 1.0600176103566445e+001;
        q50HzWC00(40) = 2.8120201836734689e-002;
        h50HzWC00(40) = 9.8853667841909019e+000;
        q50HzWC00(41) = 2.8841232653061218e-002;
        h50HzWC00(41) = 9.1230452295439406e+000;
        q50HzWC00(42) = 2.9562263469387753e-002;
        h50HzWC00(42) = 8.3134519496476074e+000;
        q50HzWC00(43) = 3.0283294285714284e-002;
        h50HzWC00(43) = 7.4568425084377630e+000;
        q50HzWC00(44) = 3.1004325102040813e-002;
        h50HzWC00(44) = 6.5532743493808816e+000;
        q50HzWC00(45) = 3.1725355918367344e-002;
        h50HzWC00(45) = 5.6023480434190631e+000;
        q50HzWC00(46) = 3.2446386734693869e-002;
        h50HzWC00(46) = 4.6028999283594452e+000;
        q50HzWC00(47) = 3.3167417551020408e-002;
        h50HzWC00(47) = 3.5526431088344168e+000;
        q50HzWC00(48) = 3.3888448367346932e-002;
        h50HzWC00(48) = 2.4477537859472243e+000;
        q50HzWC00(49) = 3.4609479183673464e-002;
        h50HzWC00(49) = 1.2823998857284948e+000;
        q50HzWC00(50) = 3.5330509999999996e-002;
        h50HzWC00(50) = 4.8208955523495689e-002;

        q_0 = q_media*(P.f0/f);
        P.q_0 = q_0;

        if (q_0 < 0)
            H_0 = 1.0694e+003;
        elseif (q_0 > max(q50HzWC00))
            H_0 = 1.0694e+003;
        else
            H_0 = interp1(q50HzWC00, h50HzWC00*P.nestagios, q_0);

        end

            
        if isnan(H_0)
            H_0 = 1.0694e+003;
        end


        H = H_0*(f/P.f0)^2;
        dp = 2.5*H*P.rho(2)*P.g;

     otherwise

        
end
end

